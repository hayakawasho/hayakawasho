---
import { GoogleFontsOptimizer } from "astro-google-fonts-optimizer";
import { ClientOnly } from "./client-only.tsx";
import "./_components/page.work/index.module.scss";
import "./_components/page.work-single/index.module.scss";
import gallerymodernFont  from "./assets/gallerymodern-webfont.woff2"
import type { RouteName } from "./_foundation/type";

export interface Props {
	title: string;
  permalink: string;
  namespace: RouteName;
}

const { props } = Astro;

const SITE_URL = 'https://shohayakawa.dev';
const siteTitle = 'Sho Hayakawa Portfolio';
const description = 'Frontend Engineer Sho Hayakawa 早川翔 portfolio website';

const title = props.title ? props.title + ' - ' + siteTitle : siteTitle;

const idDev = process.env.NODE_ENV !== 'production';
---

<!DOCTYPE html>
<html lang="ja">
	<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <slot name="prependHead" />
    {
      // <link
      //   as="font"
      //   href={gallerymodernFont}
      //   rel="preload"
      //   type="font/woff2"
      // />
    }
    {!idDev && (
      <link
        as="style"
        href="/assets/entry.css"
        onload="this.onload=null;this.rel='stylesheet';"
        rel="preload"
      />
    )}
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
    <meta name="format-detection" content="telephone=no" />
    <title>{title}</title>
    <meta content={description} name="description" />
    <meta content={title} property="og:title" />
    <meta content={props.permalink ? 'article' : 'website'} property="og:type" />
    <meta content={description} property="og:description" />
    <meta content={SITE_URL + props.permalink} property="og:url" />
    <meta content={siteTitle} property="og:site_name" />
    <meta content={SITE_URL + '/ogp.jpg'} property="og:image" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link href="https://db.onlinewebfonts.com/c/4d4f45d65a23eec6fb297a1bcf0c046f?family=SchnyderMLight" rel="stylesheet" type="text/css"/>
    <GoogleFontsOptimizer url="https://fonts.googleapis.com/css2?family=Jost:wght@400&display=swap" />
    {idDev && (
      <script defer src={`http://${process.env.LOCAL_IP_ADDR || 'localhost'}:5173/src/entry.ts`} type="module" />
    )}
    {!idDev && <script defer src="/assets/entry.js" type="module" />}
	</head>
  <body class="" data-page={props.namespace}>
    <div
      aria-hidden="true"
      class="svh | fixed inset-0 w-screen pointer-events-none -z-1 invisible"
      data-ref="windowSizeWatcher"
    ></div>
    <div class="bg" aria-hidden="true"></div>
    <canvas aria-hidden="true" class="glCanvas" data-ref="backCanvas"></canvas>
    <div class="grad grad--upper" aria-hidden="true"></div>
    <div class="grad grad--lower" aria-hidden="true"></div>
    <div class="gridLine gridLine--left" aria-hidden="true"></div>
    <div class="gridLine gridLine--middle" aria-hidden="true"></div>
    <div class="gridLine gridLine--right" aria-hidden="true"></div>
    <slot />
    <canvas aria-hidden="true" class="glCanvas" data-ref="frontCanvas"></canvas>
    <div class="uiCursor" data-ref="cursor"></div>
    <ClientOnly client:only="react" />
  </body>
</html>

<style lang="scss" is:global>
  @font-face {
    font-family: "Gallery Modern";
    src: url("./assets/gallerymodern-webfont.woff2") format("woff2");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }


  .svh {
    height: 100vh;
    height: 100svh;
  }

  .grad {
    pointer-events: none;
    display: block;
    height: 20vh;
    width: 100%;
    position: fixed;
    z-index: 11;
    left: 0;

    @media (min-width: 640px) {
      height: 25vh;
    }
  }

  .grad--upper {
    top: 0;
    opacity: 0.4;

    background-image: linear-gradient(
      hsla(0, 0%, 0%, 0.5),
      hsla(0, 0%, 0%, 0.49016) 1.17%,
      hsla(0, 0%, 0%, 0.46296) 4.49%,
      hsla(0, 0%, 0%, 0.42188) 9.72%,
      hsla(0, 0%, 0%, 0.37037) 16.59%,
      hsla(0, 0%, 0%, 0.31192) 24.86%,
      hsla(0, 0%, 0%, 0.25) 34.25%,
      hsla(0, 0%, 0%, 0.18808) 44.52%,
      hsla(0, 0%, 0%, 0.12963) 55.41%,
      hsla(0, 0%, 0%, 0.07813) 66.66%,
      hsla(0, 0%, 0%, 0.03704) 78.01%,
      hsla(0, 0%, 0%, 0.00984) 89.21%,
      hsla(0, 0%, 0%, 0)
    );
  }

  .grad--lower {
    bottom: 0;
    opacity: 0.3;

    background-image: linear-gradient(
      hsla(0, 0%, 0%, 0),
      hsla(0, 0%, 0%, 0.00984) 10.79%,
      hsla(0, 0%, 0%, 0.03704) 21.99%,
      hsla(0, 0%, 0%, 0.07813) 33.34%,
      hsla(0, 0%, 0%, 0.12963) 44.59%,
      hsla(0, 0%, 0%, 0.18808) 55.48%,
      hsla(0, 0%, 0%, 0.25) 65.75%,
      hsla(0, 0%, 0%, 0.31192) 75.14%,
      hsla(0, 0%, 0%, 0.37037) 83.41%,
      hsla(0, 0%, 0%, 0.42188) 90.28%,
      hsla(0, 0%, 0%, 0.46296) 95.51%,
      hsla(0, 0%, 0%, 0.49016) 98.83%,
      hsla(0, 0%, 0%, 0.5)
    );
  }

  .gridLine {
    pointer-events: none;
    position: fixed;
    top: 0;
    width: 1px;
    height: 100%;
    transform: translateX(-50%);
    background: rgba(4, 31, 30, 0.07);

    @media (prefers-color-scheme: dark) {
      background: rgba(255, 246, 229, 0.07);
    }
  }

  .gridLine--left {
    left: 2rem;

    @media (min-width: 640px) {
      left: 25%;
    }
  }

  .gridLine--middle {
    left: 50%;
  }

  .gridLine--right {
    right: 2rem;

    @media (min-width: 640px) {
      right: auto;
      left: 75%;
    }
  }


  .glCanvas {
    contain: strict;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    overflow: clip;
    transform: rotate(0.0001deg);
    pointer-events: none;
    user-select: none;
  }

  .uiCursor {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 999;

    @media not (hover: hover) {
      display: none;
    }
  }
</style>

<style lang="scss">
  .bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    background: linear-gradient(180deg, #fff, #eaeaea);

    @media (prefers-color-scheme: dark) {
      background: var(--color-bg);
    }
  }
</style>
