---
import WorkSingle from "../../_components/page/work.[id]/index.page";
import Head from "../../_components/ui/layout/head.astro";
import Seo from "../../_components/ui/layout/seo.astro";
import { WorkDataMap } from "../../_models/work/mapper";
import { WorkRepository } from "../../_repositories/work/repository";

export async function getStaticPaths() {
  const workRepository = new WorkRepository();
  const { works, totalCount } = await workRepository.findAll();
  const allPosts = works.map(WorkDataMap.toDTO);
  const first = allPosts[0];
  const last = allPosts[allPosts.length - 1];

  return allPosts.map((post, index) => ({
    params: {
      id: post.id,
    },
    props: {
      allPosts,
      post,
      prev: first.id === post.id ? last : allPosts[index - 1],
      next: last.id === post.id ? first : allPosts[index + 1],
      total: totalCount,
      currentIndex: index,
    },
  }));
}

const { allPosts, post, currentIndex } = Astro.props;
---

<!DOCTYPE html>
<html
  lang="ja"
  style={`${post.theme === "light"
    ? "--theme-text: var(--color-dark); --theme-bg: var(--color-light);"
    : "--theme-text: var(--color-light); --theme-bg: var(--color-dark);"
  }`}
>
  <Head>
    <Seo title={post.name} url={`/work/${post.id}/`} />
  </Head>
  <WorkSingle allPosts={allPosts} currentIndex={currentIndex} />
</html>
