---
import Layout from '~/layout.astro';
import WorksDetail from '~/_features/page.works-single/view';
import dotenv from 'dotenv';
import { WorksRepository } from '~/_repositories/works';

dotenv.config();

const repository = WorksRepository.create(process.env.API_KEY!);

export async function getStaticPaths() {
  const { works } = await repository.findList({
    limit: 99,
    orders: '-launch',
  });

  return works.map((item) => ({
    params: {
      slug: item.id,
    },
  }));
}

const { slug } = Astro.params;
const result = await repository.findOne(slug);
---

<Layout title="Works" permalink=''>
  <link
    slot="prependHead"
    as="image"
    crossorigin="anonymous"
    href=""
    media=""
    rel="preload"
  />
  <WorksDetail />
</Layout>
